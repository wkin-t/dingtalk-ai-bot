# coding-policy.md

## 目标
在保证质量与稳定性的前提下，按任务复杂度智能选择思考深度与执行策略。

## 思考深度路由（Codex）
- **low**：小改动、文案、注释、配置微调
- **medium（默认）**：常规需求、单模块重构、普通 bug 修复
- **high**：跨文件改造、接口调整、复杂业务逻辑
- **xhigh**：高风险变更（部署链路、迁移、权限/安全、生产事故修复）

## 任务分流规则
1. **先判断风险再编码**：涉及部署/鉴权/数据迁移优先 high 或 xhigh。
2. **先最小可用，再增强**：先提交可运行版本，再补优化。
3. **跨模块改造必须给回滚点**：保留旧逻辑开关或单独提交。
4. **每次改动必须可验证**：至少有启动验证或接口检查。

## 提交流程（强制）
1. 拉取最新代码：`git fetch && git pull --rebase origin master`
2. 本地验证：测试/静态检查（若可用）
3. 小步提交：每个 commit 单一目的
4. 提交信息规范：
   - `feat:` 新功能
   - `fix:` 修复
   - `refactor:` 重构
   - `docs:` 文档
   - `chore:` 杂项

## 部署与回滚
- 部署遵循 `deploy-pipeline`。
- 失败最多重试 2 次，第 3 次必须回滚。
- 禁止“口头成功”，必须有命令输出证明。

## 安全边界
- 不提交 `.env`、密钥、令牌。
- 涉及权限变更时，先说明影响面再执行。
- 对 group agents 保持最小权限原则（deny 敏感工具 + 沙箱隔离）。

## 输出要求
每次任务最终输出至少包含：
- 改了哪些文件
- 如何验证
- 风险点与回滚建议（如有）
